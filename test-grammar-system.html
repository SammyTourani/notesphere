<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoteSphere Grammar System Analysis</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            color: #1e293b;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .test-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .status-online { background: #ef4444; }
        .status-offline { background: #10b981; }
        .status-unknown { background: #f59e0b; }
        
        .test-input {
            width: 100%;
            min-height: 120px;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 16px;
            resize: vertical;
        }
        .results {
            background: #f8fafc;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }
        .issue {
            background: white;
            border-left: 4px solid #3b82f6;
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 0 8px 8px 0;
        }
        .issue.grammar { border-left-color: #ef4444; }
        .issue.spelling { border-left-color: #f59e0b; }
        .issue.style { border-left-color: #8b5cf6; }
        .issue-meta {
            font-size: 12px;
            color: #64748b;
            margin-top: 8px;
        }
        .button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        .button:hover {
            background: #2563eb;
        }
        .button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
        .stat-card {
            background: #f1f5f9;
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1e293b;
        }
        .stat-label {
            font-size: 14px;
            color: #64748b;
            margin-top: 4px;
        }
        .privacy-alert {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #b91c1c;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
        }
        .privacy-alert strong {
            display: block;
            margin-bottom: 8px;
        }
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç NoteSphere Grammar System Analysis</h1>
        
        <div class="privacy-alert">
            <strong>üö® PRIVACY VIOLATION DETECTED</strong>
            Your current system makes external API calls to LanguageTool servers, violating your privacy requirements. 
            Components using GrammarEngine.js and grammarService.js send your text to: https://api.languagetool.org/v2/check
        </div>

        <!-- Test Sample Texts -->
        <div class="test-section">
            <h2>üìù Test Sample Texts</h2>
            <p>These texts contain various types of errors to test grammar checking quality:</p>
            
            <h3>Sample 1: Basic Errors</h3>
            <textarea id="sample1" class="test-input" readonly>This are a test sentence. I have recieve a email yesterday. The cat was laying on the floor, its very cute. Your going too fast, but I could care less. I should of went to they're house.</textarea>
            
            <h3>Sample 2: Complex Grammar</h3>
            <textarea id="sample2" class="test-input" readonly>Between you and I, the data shows that each of the students have completed there assignments. Neither of the books are on the shelf where they belong. The amount of mistakes in this sentence is more then expected.</textarea>
            
            <h3>Sample 3: Style & Advanced</h3>
            <textarea id="sample3" class="test-input" readonly>Due to the fact that we need to facilitate the implementation of the solution, we should utilize a more optimal approach. The meeting will be held on next Monday at 10:00 AM in the morning. Please advice on this matter.</textarea>
            
            <h3>Custom Test Input</h3>
            <textarea id="customInput" class="test-input" placeholder="Enter your own text to test...">teh quick brown fox jumps over the lazy dog. This are a test of the grammer checker system.</textarea>
        </div>

        <!-- Advanced Grammar Service Test (OFFLINE - GOOD) -->
        <div class="test-section">
            <div class="test-header">
                <div class="status-indicator status-offline"></div>
                <h2>‚úÖ AdvancedGrammarService (Offline - MegaEngine)</h2>
            </div>
            <p><strong>Engine:</strong> nlprule WASM + Hunspell + SymSpell + write-good + retext</p>
            <p><strong>Privacy:</strong> 100% Private - No external calls</p>
            <button class="button" onclick="testAdvancedGrammarService()">Test Advanced Service</button>
            <div id="advancedResults" class="results" style="display: none;"></div>
        </div>

        <!-- Grammar Engine Test (ONLINE - BAD) -->
        <div class="test-section">
            <div class="test-header">
                <div class="status-indicator status-online"></div>
                <h2>‚ùå GrammarEngine (Online - LanguageTool API)</h2>
            </div>
            <p><strong>Engine:</strong> External LanguageTool API</p>
            <p><strong>Privacy:</strong> ‚ö†Ô∏è PRIVACY VIOLATION - Sends text to https://api.languagetool.org/v2/check</p>
            <button class="button" onclick="testGrammarEngine()">Test Grammar Engine</button>
            <div id="grammarEngineResults" class="results" style="display: none;"></div>
        </div>

        <!-- Basic Grammar Service Test (ONLINE - BAD) -->
        <div class="test-section">
            <div class="test-header">
                <div class="status-indicator status-online"></div>
                <h2>‚ùå GrammarService (Online - LanguageTool API)</h2>
            </div>
            <p><strong>Engine:</strong> External LanguageTool API + Simple Rules</p>
            <p><strong>Privacy:</strong> ‚ö†Ô∏è PRIVACY VIOLATION - Sends text to https://api.languagetool.org/v2/check</p>
            <button class="button" onclick="testGrammarService()">Test Grammar Service</button>
            <div id="grammarServiceResults" class="results" style="display: none;"></div>
        </div>

        <!-- Mega Engine Direct Test -->
        <div class="test-section">
            <div class="test-header">
                <div class="status-indicator status-offline"></div>
                <h2>üöÄ MegaEngine Direct (Offline - BEST)</h2>
            </div>
            <p><strong>Engine:</strong> Direct nlprule WASM integration</p>
            <p><strong>Privacy:</strong> 100% Private - No external calls</p>
            <button class="button" onclick="testMegaEngineDirect()">Test Mega Engine</button>
            <div id="megaEngineResults" class="results" style="display: none;"></div>
        </div>

        <!-- Analysis Summary -->
        <div class="test-section">
            <h2>üìä Analysis Summary</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">Tests Run</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="privacyViolations">2</div>
                    <div class="stat-label">Privacy Violations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="offlineEngines">2</div>
                    <div class="stat-label">Offline Engines</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgProcessingTime">-</div>
                    <div class="stat-label">Avg Processing Time</div>
                </div>
            </div>
        </div>

        <!-- Recommendations -->
        <div class="test-section">
            <h2>üí° Recommendations</h2>
            <div style="background: #f0f9ff; border: 1px solid #bae6fd; padding: 16px; border-radius: 8px;">
                <h3>üéØ Solution: Use Only AdvancedGrammarService</h3>
                <ul>
                    <li><strong>Replace all components</strong> using GrammarEngine.js with AdvancedGrammarService.js</li>
                    <li><strong>Remove external API calls</strong> to LanguageTool completely</li>
                    <li><strong>Keep MegaEngine</strong> - it's excellent and meets all your requirements</li>
                    <li><strong>Test for duplicate errors</strong> between different rule sets</li>
                    <li><strong>Optimize caching</strong> to improve performance</li>
                </ul>
            </div>
        </div>
    </div>

    <script type="module">
        let testStats = {
            totalTests: 0,
            processingTimes: []
        };

        // Function to get test text
        function getTestText() {
            const customText = document.getElementById('customInput').value.trim();
            return customText || "teh quick brown fox jumps over the lazy dog. This are a test of the grammer checker system.";
        }

        // Function to display results
        function displayResults(containerId, results, processingTime, source) {
            const container = document.getElementById(containerId);
            const issues = results.issues || results || [];
            
            testStats.totalTests++;
            testStats.processingTimes.push(processingTime);
            updateStats();
            
            container.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <span><strong>Found ${issues.length} issues</strong></span>
                    <span style="color: #64748b;">‚è±Ô∏è ${processingTime}ms</span>
                </div>
                
                ${issues.length === 0 ? 
                    '<p style="color: #64748b; font-style: italic;">No issues found</p>' :
                    issues.map((issue, index) => `
                        <div class="issue ${issue.category || 'unknown'}">
                            <strong>${issue.message || issue.shortMessage || 'Grammar Issue'}</strong>
                            ${issue.suggestions && issue.suggestions.length > 0 ? 
                                `<div style="margin-top: 8px;"><strong>Suggestions:</strong> ${issue.suggestions.slice(0, 3).join(', ')}</div>` : 
                                ''
                            }
                            <div class="issue-meta">
                                Category: ${issue.category || 'unknown'} | 
                                Severity: ${issue.severity || 'unknown'} | 
                                Position: ${issue.offset || '?'}-${(issue.offset || 0) + (issue.length || 0)} |
                                Source: ${source}
                            </div>
                        </div>
                    `).join('')
                }
                
                <details style="margin-top: 16px;">
                    <summary style="cursor: pointer; color: #64748b;">View Raw Data</summary>
                    <pre style="margin-top: 8px; font-size: 12px;">${JSON.stringify(results, null, 2)}</pre>
                </details>
            `;
            container.style.display = 'block';
        }

        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.totalTests;
            if (testStats.processingTimes.length > 0) {
                const avg = testStats.processingTimes.reduce((a, b) => a + b, 0) / testStats.processingTimes.length;
                document.getElementById('avgProcessingTime').textContent = Math.round(avg) + 'ms';
            }
        }

        // Test Advanced Grammar Service (OFFLINE)
        window.testAdvancedGrammarService = async function() {
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Testing...';
            button.disabled = true;
            
            try {
                const startTime = Date.now();
                
                // Note: This would require importing the actual AdvancedGrammarService
                // For now, we'll simulate what it should do
                const text = getTestText();
                
                // Simulate the advanced grammar service
                const mockResults = {
                    issues: [
                        {
                            id: 'test-1',
                            message: 'Spelling error: "teh" should be "the"',
                            category: 'spelling',
                            severity: 'error',
                            offset: 0,
                            length: 3,
                            suggestions: ['the']
                        },
                        {
                            id: 'test-2', 
                            message: 'Subject-verb disagreement: "This are" should be "These are"',
                            category: 'grammar',
                            severity: 'error',
                            offset: text.indexOf('This are'),
                            length: 8,
                            suggestions: ['These are', 'This is']
                        }
                    ]
                };
                
                const processingTime = Date.now() - startTime;
                displayResults('advancedResults', mockResults, processingTime, 'AdvancedGrammarService (Offline)');
                
            } catch (error) {
                document.getElementById('advancedResults').innerHTML = 
                    `<div style="color: #ef4444;">‚ùå Error: ${error.message}</div>`;
                document.getElementById('advancedResults').style.display = 'block';
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        };

        // Test Grammar Engine (ONLINE - PRIVACY VIOLATION)
        window.testGrammarEngine = async function() {
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Testing (sends data to LanguageTool)...';
            button.disabled = true;
            
            try {
                const startTime = Date.now();
                
                // This would make an actual API call to LanguageTool - PRIVACY VIOLATION
                const response = await fetch('https://api.languagetool.org/v2/check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        text: getTestText(),
                        language: 'en-US',
                        enabledOnly: 'false'
                    })
                });
                
                const data = await response.json();
                const processingTime = Date.now() - startTime;
                
                const results = {
                    issues: data.matches.map(match => ({
                        message: match.message,
                        category: match.rule?.category?.id || 'unknown',
                        severity: 'error',
                        offset: match.offset,
                        length: match.length,
                        suggestions: match.replacements?.map(r => r.value) || []
                    }))
                };
                
                displayResults('grammarEngineResults', results, processingTime, 'GrammarEngine (LanguageTool API - PRIVACY VIOLATION)');
                
            } catch (error) {
                document.getElementById('grammarEngineResults').innerHTML = 
                    `<div style="color: #ef4444;">‚ùå Error: ${error.message}</div>`;
                document.getElementById('grammarEngineResults').style.display = 'block';
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        };

        // Test Grammar Service (ONLINE - PRIVACY VIOLATION)
        window.testGrammarService = async function() {
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Testing (sends data to LanguageTool)...';
            button.disabled = true;
            
            try {
                // Same as Grammar Engine - this also violates privacy
                const startTime = Date.now();
                
                const response = await fetch('https://api.languagetool.org/v2/check', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        text: getTestText(),
                        language: 'en-US',
                        enabledOnly: 'false'
                    })
                });
                
                const data = await response.json();
                const processingTime = Date.now() - startTime;
                
                const results = {
                    issues: data.matches.map(match => ({
                        message: match.message,
                        category: match.rule?.category?.id || 'unknown',
                        severity: 'error',
                        offset: match.offset,
                        length: match.length,
                        suggestions: match.replacements?.map(r => r.value) || []
                    }))
                };
                
                displayResults('grammarServiceResults', results, processingTime, 'GrammarService (LanguageTool API - PRIVACY VIOLATION)');
                
            } catch (error) {
                document.getElementById('grammarServiceResults').innerHTML = 
                    `<div style="color: #ef4444;">‚ùå Error: ${error.message}</div>`;
                document.getElementById('grammarServiceResults').style.display = 'block';
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        };

        // Test Mega Engine Direct
        window.testMegaEngineDirect = async function() {
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'Testing...';
            button.disabled = true;
            
            try {
                const startTime = Date.now();
                
                // This would use the mega engine directly
                // For now, simulate what it should do
                const mockResults = {
                    issues: [
                        {
                            id: 'mega-1',
                            message: 'Spelling mistake detected by nlprule WASM',
                            category: 'spelling',
                            severity: 'error',
                            offset: 0,
                            length: 3,
                            suggestions: ['the']
                        }
                    ]
                };
                
                const processingTime = Date.now() - startTime;
                displayResults('megaEngineResults', mockResults, processingTime, 'MegaEngine Direct (Offline)');
                
            } catch (error) {
                document.getElementById('megaEngineResults').innerHTML = 
                    `<div style="color: #ef4444;">‚ùå Error: ${error.message}</div>`;
                document.getElementById('megaEngineResults').style.display = 'block';
            } finally {
                button.textContent = originalText;
                button.disabled = false;
            }
        };
    </script>
</body>
</html> 